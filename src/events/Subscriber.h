/////////////////////////////////////////////////
/// @file
/// @brief Declaration of the Subscriber class.
/////////////////////////////////////////////////

/////////////////////////////////////////////////
/// Preprocessor Directives
/////////////////////////////////////////////////
#pragma once

#include "EventPacket.h"
#include "FailInfo.h"
#include <expected>
#include <utility>
#include <variant>
namespace steamrot {

/////////////////////////////////////////////////
/// @class Subscriber
/// @brief For registering with the EventHandler
///
/// This is deigned to be faily lightweight and does not handle any
/// events/actions itself. It is simply toggled
///
/////////////////////////////////////////////////
struct Subscriber {

private:
  /////////////////////////////////////////////////
  /// @brief Indicates whether the subscriber is active or not.
  /////////////////////////////////////////////////
  bool m_active{false};

  /////////////////////////////////////////////////
  /// @brief Used to register the subscriber with the EventHandler.
  /////////////////////////////////////////////////
  const EventType m_event_type;

  /////////////////////////////////////////////////
  /// @brief Used as a key to store the subscriber in the EventHandler.
  /////////////////////////////////////////////////
  const EventData m_event_data;

public:
  /////////////////////////////////////////////////
  /// @brief Constructor for the Subscriber class.
  /////////////////////////////////////////////////
  Subscriber(const EventType event_type, const EventData &event_data);

  /////////////////////////////////////////////////
  /// @brief Delete the default constructor to prevent instantiation without
  /// parameters.
  /////////////////////////////////////////////////
  Subscriber() = delete;

  /////////////////////////////////////////////////
  /// @brief Inspect the subscriber to see if it is active.
  ///
  /// @return Boolean indicating whether the subscriber is active.
  /////////////////////////////////////////////////
  bool IsActive() const;

  /////////////////////////////////////////////////
  /// @brief Turn the subscriber on
  ///
  /////////////////////////////////////////////////
  std::expected<std::monostate, FailInfo> SetActive();

  /////////////////////////////////////////////////
  /// @brief Turn the subscriber off
  /////////////////////////////////////////////////
  std::expected<std::monostate, FailInfo> SetInactive();

  /////////////////////////////////////////////////
  /// @brief Provide the registration information for the subscriber.
  /////////////////////////////////////////////////
  std::pair<EventType, EventData> GetRegistrationInfo() const;
};
} // namespace steamrot
