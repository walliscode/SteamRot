/////////////////////////////////////////////////
/// @file
/// @brief Declaration of the ArchetypeManager class
/////////////////////////////////////////////////

////////////////////////////////////////////////////////////
// Preprocessor directives
////////////////////////////////////////////////////////////
#pragma once

////////////////////////////////////////////////////////////
// Headers
////////////////////////////////////////////////////////////
#include "ArchetypeHelpers.h"
#include "containers.h"
#include <cstddef>
#include <cstdlib>
#include <unordered_map>
#include <vector>

namespace steamrot {
////////////////////////////////////////////////////////////
// typedefs
////////////////////////////////////////////////////////////
using Archetype = std::vector<size_t>;

/////////////////////////////////////////////////
/// @class ArchetypeManager
/// @brief Manages the creation and retrieval of Archetypes
///
/////////////////////////////////////////////////
class ArchetypeManager {
private:
  /////////////////////////////////////////////////
  /// @brief Contains all archetypes for (this->Scenes) entity memory pool.
  /////////////////////////////////////////////////
  std::unordered_map<ArchetypeID, Archetype> m_archetypes;

  const ArchetypeID
  GenerateArchetypeID(const EntityMemoryPool &entity_memory_pool,
                      size_t entity_index);

public:
  /////////////////////////////////////////////////
  /// @brief Default constructor for ArchetypeManager
  /////////////////////////////////////////////////
  ArchetypeManager();

  /////////////////////////////////////////////////
  /// @brief Returns the entity indexes for the given archetype IDs.
  ///
  /// @param An almgamated vector of ArchetypeIDs.
  /////////////////////////////////////////////////
  std::vector<size_t>
  GetEntityIndexes(const std::vector<ArchetypeID> &archtype_IDs) const;

  /////////////////////////////////////////////////
  /// @brief Clears current archetypes and generates all archetypes
  ///
  /// @param entity_memory_pool Reference to the EntityMemoryPool in the scene
  /////////////////////////////////////////////////
  void GenerateAllArchetypes(const EntityMemoryPool &entity_memory_pool);

  /////////////////////////////////////////////////
  /// @brief Returns the archetypes map.
  /////////////////////////////////////////////////
  const std::unordered_map<ArchetypeID, Archetype> &GetArchetypes() const;
};

} // namespace steamrot
