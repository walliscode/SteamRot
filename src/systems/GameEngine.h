/////////////////////////////////////////////////
/// @file
/// @brief GameEngine class declaration.
/////////////////////////////////////////////////

////////////////////////////////////////////////////////////
// Headers
////////////////////////////////////////////////////////////
#include "AssetManager.h"
#include "DisplayManager.h"
#include "EventHandler.h"
#include "SceneManager.h"
#include <SFML/Graphics.hpp>

namespace steamrot {
/////////////////////////////////////////////////
/// @class GameEngine
/// @brief Methods for managing the game loop, user input and object
/// communication.
/////////////////////////////////////////////////
class GameEngine {
private:
  /////////////////////////////////////////////////
  /// @brief Variable to keep track of the current loop number.
  ///
  /// Increments by 1 at the start of each loop, the game will be maxed out at
  /// 60FPS so on a 32 bit system this will last 2.27 years. and on a 64 bit
  /// system this will last 9.75 trillion years. Probably long enough.
  /////////////////////////////////////////////////
  size_t m_loop_number = 0;

  /////////////////////////////////////////////////
  /// @brief Member: RenderWindow for the game engine
  /////////////////////////////////////////////////
  sf::RenderWindow m_window;

  /////////////////////////////////////////////////
  /// @brief EventHandler for managing events, this should be the only instance
  /////////////////////////////////////////////////
  EventHandler m_event_handler;

  /////////////////////////////////////////////////
  /// @brief AssetManager for managing game assets, this should be the only
  /// instance
  /////////////////////////////////////////////////
  AssetManager m_asset_manager;

  /////////////////////////////////////////////////
  /// @brief SceneManager for managing game scenes, this should be the only
  /// instance
  /////////////////////////////////////////////////
  SceneManager m_scene_manager;

  /////////////////////////////////////////////////
  /// @brief DisplayManager for rendering and display management
  /////////////////////////////////////////////////
  DisplayManager m_display_manager;

  /////////////////////////////////////////////////
  /// @brief Wrapper function to update any relevant systems
  /////////////////////////////////////////////////
  void UpdateSystems();

  /////////////////////////////////////////////////
  /// @brief Start up the game engine and load any resources
  /////////////////////////////////////////////////
  void StartUp();

  /////////////////////////////////////////////////
  /// @brief Run the game loop until exit condition is met
  /////////////////////////////////////////////////
  void RunGameLoop();

  ////////////////////////////////////////////////////////////
  /// \brief Shutdown the game engine
  ///
  ////////////////////////////////////////////////////////////
  void ShutDown();

  sf::Vector2i m_mouse_position;

  void UpdateLocalMousePosition();

public:
  ////////////////////////////////////////////////////////////
  /// \brief Default constructor
  ///
  ////////////////////////////////////////////////////////////
  GameEngine(const EnvironmentType env_type = EnvironmentType::Production);

  ////////////////////////////////////////////////////////////
  /// \brief Start up and Run the game engine
  ///
  ////////////////////////////////////////////////////////////
  void RunGame(size_t numLoops = 0, bool use_test_window = false);

  ////////////////////////////////////////////////////////////
  /// \brief Get the current loop number
  ///
  ////////////////////////////////////////////////////////////
  size_t getLoopNumber();

  /////////////////////////////////////////////////
  /// @brief Getter function for the GameEngine's RenderWindow
  /////////////////////////////////////////////////
  sf::RenderWindow &GetWindow();
};

} // namespace steamrot
