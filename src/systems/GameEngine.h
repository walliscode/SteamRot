////////////////////////////////////////////////////////////
// Headers
////////////////////////////////////////////////////////////
#include "DataManager.h"
#include "DisplayManager.h"
#include "EventHandler.h"
#include "Logger.h"
#include "SceneManager.h"
#include <SFML/Graphics.hpp>

#include <memory>
#include <nlohmann/json.hpp>
using json = nlohmann::json;

namespace steamrot {
class GameEngine {
private:
  ////////////////////////////////////////////////////////////
  // Member data
  ////////////////////////////////////////////////////////////
  DisplayManager m_display_manager;
  std::unique_ptr<SceneManager> m_scene_manager;
  DataManager m_data_manager;
  Logger m_logger;
  EventHandler m_event_handler;

  size_t m_loop_number = 0;
  ////////////////////////////////////////////////////////////
  /// \brief Update all Systems
  ///
  ////////////////////////////////////////////////////////////
  void UpdateSystems();

  ////////////////////////////////////////////////////////////
  /// \brief Render Game Drwables
  ///
  ////////////////////////////////////////////////////////////
  void sRender();

  ////////////////////////////////////////////////////////////
  /// \brief Shutdown the game engine
  ///
  ////////////////////////////////////////////////////////////
  void ShutDown();

public:
  ////////////////////////////////////////////////////////////
  /// \brief Default constructor
  ///
  ////////////////////////////////////////////////////////////
  GameEngine();

  ////////////////////////////////////////////////////////////
  /// \brief Start up and Run the game engine
  ///
  ////////////////////////////////////////////////////////////
  void RunGame(size_t numLoops = 0, bool use_test_window = false);

  ////////////////////////////////////////////////////////////
  /// \brief Get the current loop number
  ///
  ////////////////////////////////////////////////////////////
  size_t getLoopNumber();

  ////////////////////////////////////////////////////////////
  /// \brief Run the simulation (the while loop for a given number)
  ///
  ////////////////////////////////////////////////////////////
  void RunSimulation(int loops);

  ////////////////////////////////////////////////////////////
  /// \brief Export simulation data to a json file for testing
  ///
  ////////////////////////////////////////////////////////////
  void ExportSimulationData(const std::string &file_name);
};

} // namespace steamrot
